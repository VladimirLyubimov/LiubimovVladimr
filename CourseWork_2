#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <wchar.h>
#include <locale.h>
 
struct MyWord{
    wchar_t* buf;
    int num;
    //int len;
};
 
typedef struct MyWord word;
 
struct MySentence{
    word* buf;
    int len;
    int num;
};
 
typedef struct MySentence sentence;
 
struct MyText{
    sentence* buf;
    int len;
    int trlen;
};
 
typedef struct MyText text;
 
text ReadText(){
	text intext;
	wchar_t wc, ctrlwc;
	int tsize = 10;
    int ssize = 10;
    int wsize = 10;
	int i, j, k;
	i = 0;
	j = 0;
	k = 0;
	intext.buf = malloc(tsize * sizeof(sentence*));
    intext.buf[i].buf = malloc(ssize * sizeof(word*));
    intext.buf[i].buf[j].buf = malloc(wsize * sizeof(wchar_t));
	wc = ' ';
	while (!wcschr(L"!", wc)){
        wc = fgetwc(stdin);
        //wprintf(L"%c", wc);
        //if (wcschr(L"!", wc))
            //break;
        intext.buf[i].buf[j].buf[k] = wc;
        //wprintf(L"%c", intext.buf[i].buf[j].buf[k]);
        printf("%d %d\n", j, i);
        if (wcschr(L" \n", wc)){
            //intext.buf[i].buf[j].len = k - 2;
            intext.buf[i].buf[j].buf[k + 1] = L'\0';
            ctrlwc = intext.buf[i].buf[j].buf[k - 1];
            intext.buf[i].buf[j].num = j + 1;
            k = 0;
            wsize = 10;
            j = j + 1;
            intext.buf[i].buf[j].buf = malloc(wsize * sizeof(wchar_t));
            if (wcschr(L".", ctrlwc)){
                ssize = 10;
                intext.buf[i].len = j + 1;
                j = 0;
                i = i + 1;
                intext.buf[i].buf = malloc(ssize * sizeof(word*));
            }
        }
        
        if (k == wsize - 3){
            wsize = wsize + 10;
            intext.buf[i].buf[j].buf = realloc(intext.buf[i].buf[j].buf, wsize * sizeof(wchar_t));
        }
        
         if (j == wsize - 3){
            ssize = ssize + 10;
            intext.buf[i].buf = realloc(intext.buf[i].buf, ssize * sizeof(word*));
        }
        
         if (i == wsize - 3){
            tsize = tsize + 10;
            intext.buf = realloc(intext.buf, tsize * sizeof(sentence*));
        }
        k = k + 1;
	}
    
    intext.len = i;
    intext.trlen = tsize;
    
    return intext;
};

void PrintSentence(sentence outsent){
	int i = 0;
	while(i < outsent.len){
		wprintf (L"%ls",outsent.buf[i]);
		i = i + 1;
    }
};

int main(){
    text ttext;
    ttext = ReadText();
    //PrintSentence(ttext.buf[0]);
    return 0;
};
