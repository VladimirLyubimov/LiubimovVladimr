#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <wchar.h>
#include <locale.h>
 
struct MyWord{
    wchar_t* buf;
    int num;
    //int len;
};
 
typedef struct MyWord word;
 
struct MySentence{
    word* buf;
    int len;
    int num;
};
 
typedef struct MySentence sentence;
 
struct MyText{
    sentence* buf;
    int len;
    int trlen;
};
 
typedef struct MyText text;
 
text ReadText(){
	text intext;
	wchar_t wc, ctrlwc;
	int tsize = 10;
    int ssize = 10;
    int wsize = 10;
	int i, j, k;
	i = 0;
	j = 0;
	k = 0;
	intext.buf = malloc(tsize * sizeof(sentence*));
    for (int n = 0; n < 10; n++){
        intext.buf[n].buf = malloc(ssize * sizeof(word*));
        for(int m = 0; m < 10; m++)
            intext.buf[n].buf[m].buf = malloc(wsize * sizeof(wchar_t));
    }
	wc = ' ';
	while (!wcschr(L"!", wc)){
        wc = fgetwc(stdin);
        intext.buf[i].buf[j].buf[k] = wc;
        k = k + 1;
        //printf("%d %d\n", j, i);
        if (wcschr(L" \n!", wc)){
            //intext.buf[i].buf[j].len = k - 2;
            intext.buf[i].buf[j].buf[k] = L'\0';
            ctrlwc = intext.buf[i].buf[j].buf[k - 2];
            intext.buf[i].buf[j].num = j + 1;
            k = 0;
            wsize = 10;
            j = j + 1;
            //intext.buf[i].buf[j].buf = malloc(wsize * sizeof(wchar_t));
            if (wcschr(L".", ctrlwc)){
                ssize = 10;
                intext.buf[i].len = j + 1;
                j = 0;
                i = i + 1;
                //intext.buf[i].buf = malloc(ssize * sizeof(word*));
            }
        }
        if (k == wsize - 2){
            wsize = wsize + 10;
            intext.buf[i].buf[j].buf = realloc(intext.buf[i].buf[j].buf, wsize * sizeof(wchar_t));
        }

        if (j == ssize - 2){
           ssize = ssize + 10;
            intext.buf[i].buf = realloc(intext.buf[i].buf, ssize * sizeof(word*));
        }
              
         if (i == tsize - 2){
            tsize = tsize + 10;
            intext.buf = realloc(intext.buf, tsize * sizeof(sentence*));
        }
	}
    
    printf("%d", i);
    intext.len = i;
    intext.trlen = tsize;
    
    return intext;
};

void PrintWord(word outword){
	int i = 0;
	wchar_t wc = 'a';
	while(!wcschr(L"! ", wc)){
		wc = outword.buf[i];
		wprintf (L"%c", wc);
		i = i + 1;
    	}
};

void PrintSentence(sentence outsent){
	for(int i = 0; i < outsent.len; i++){
		PrintWord(outsent.buf[i]);
	}
};

void PrintText(text outtext){
	for(int i = 0; i < outtext.len; i++){
		PrintSentence(outtext.buf[i]);
	}
};

int main(){
    text ttext;
    ttext = ReadText();
    //PrintSentence(ttext.buf[0]);
    return 0;
};
